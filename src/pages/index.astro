---
import TwoColumnLayout from '../layouts/TwoColumnLayout.astro';
import Button from '../components/Button.astro';
import Card from '../components/Card.astro';
import SocialIcons from '../components/SocialIcons.astro';
import SpotifyHoverCard from '../components/SpotifyHoverCard.astro';
import * as Icon from '@astropub/icons'

const breadcrumbs = [
  { text: 'Karina Tovar', href: '/' }
];

// Test API endpoint first
let apiWorking = false;
try {
  const testResponse = await fetch(`${Astro.url.origin}/api/test`);
  const testData = await testResponse.json();
  apiWorking = testData.message === 'API is working';
} catch (error) {
  console.error('Test API failed:', error);
}

// Fetch Spotify data
let spotifyData = {
  isPlaying: false,
  artist: 'Not playing',
  songName: '',
  albumArt: '',
  songUrl: ''
};

try {
  const response = await fetch(`${Astro.url.origin}/api/spotify-now-playing`);
  spotifyData = await response.json();
} catch (error) {
  console.error('Failed to fetch Spotify data:', error);
}
---

<TwoColumnLayout
  layout_body_classes="bg-[url('/hero.png')] bg-cover"
  title="Karina Tovar - Product Designer"
  breadcrumbs={breadcrumbs}
  asideTitle={{
    line1: "Product Designer",
    line2: "Pixel Philosopher"
  }}
  bgImage="/kt.png"
  bgImageClasses="[&>img]:w-[900px] [&>img]:h-[900px] [&>img]:ml-auto items-end mix-blend-overlay opacity-40"
>
  <div slot="left-column-extra">
    <div class="flex items-center gap-1.5 mt-2">
      <span>USA Based&nbsp;·&nbsp;</span>
      <Icon.SpeakerLoud size="14" />
      <span>Listening to</span>
      <SpotifyHoverCard {...spotifyData} />
    </div>
    <SocialIcons className="mt-5" />
  </div>
  <h2 class="sticky-label">My Manifesto</h2>
  <article class="flex flex-1 gap-8">
    <Card 
      title="My motivation is to craft products that aim to help people have happier days so that they—and their loved ones—can have better lives. If you believe the same. I am your designer."
      body="In my 10+ years of experience, I've helped startups evolve from ideas to fully fledged, thoughtfully crafted products. I have worked in Email Marketing, Ad Tech, HR and FinTech. Specializing in technical software, I work tirelessly to make the tedious simple while bringing joy in every pixel and line of code.">
      <nav class="flex gap-4">
        <Button type="link" href="/work">My Work</Button>
        <Button type="link" href="/thoughts">My Thoughts</Button>
        <Button type="link" href="/cv">CV</Button>
        <Button type="link" href="/">Contact</Button>
      </nav>
    </Card>
  </article>
</TwoColumnLayout>

<style>
  .sticky-label {
    @apply sticky inset-0;
  }
</style>
